---
title: "Vulnerability data"
format:
  html:
    code-fold: true
jupyter: python3
---
The **vulnerability** of an asset is determined by its building type (e.g. 'residential 1-story building') and the inundation depth, also refered to as water depth, during a flood event. Different assests incur different degrees of damage at varying inundation levels. This **vulnerability** can be quantified via **Flood Depth-Damage** functions.
The damage function relates the water depth to the maximum potential damage per object and returns the damage fraction (a value between 0 and 1). The damage fraction is multiplied by the maximum potential damage to obtain a damage value. The value of the maximum potential damage differs per object, and must be specified in the [exposure data](http://localhost:4202/user_guide/data/exposure.html).

```{python}
#| echo: false
#| label: fig-damagefunction
#| fig-cap: "Damage functions of different assets: governmental, commercial, industrial assets"
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from pathlib import Path


file_path = Path.cwd()
for _ in range(3):
    file_path = file_path.parent

file_path = Path(file_path, ".testdata", "vulnerability", "vulnerability_curves.csv")

file_path = file_path.resolve()

data = df = pd.read_csv(file_path, comment='#')


df = pd.DataFrame({
    ('water depth'): data.iloc[:, 0],
    ('STRUCT1'): data.iloc[:, 1],
    ('STRUCT2'): data.iloc[:, 2],

})

labels=["STRUCT1","STRUCT2"]
plt.plot(df['water depth'], df['STRUCT1'])
plt.plot(df['water depth'], df['STRUCT2'])
plt.xlabel('Water depth (m)')
plt.ylabel('Fraction of maximum potential damage')
plt.legend(labels)
plt.gca().get_legend().set_title('')
```


The damage functions must be given in a two-column CSV file (`vulnerability.csv`), located in the [vulnerability folder](folder_structure.qmd). The first column contains the water depth, and the second column the corresponding damage fraction. A header row is required, describing the unit of the water depth; `#UNIT = ['unit'] (e.g., '#UNIT = metres')`. A second column, named `'#METHOD'`, must be defined for each damage-curve separately above the Damage-Curve ID. The method refers to the nature of the damage fraction, whether it's the 'maximum' or 'mean' value. The Damage-Curve ID must coincide with the information of the damage function ID defined in the exposure data file.


```{python}
#| echo: false
#| label: tbl-damage-curve
#| tbl-cap: "CSV vulnerability file "

import pandas as pd
from pathlib import Path

file_path = Path.cwd()
for _ in range(3):
    file_path = file_path.parent

file_path = Path(file_path, ".testdata", "vulnerability", "vulnerability_curves.csv")

file_path = file_path.resolve()

data = df = pd.read_csv(file_path, comment='#')


df = pd.DataFrame({
    ( 'water depth', ''): data.iloc[:, 0],
    ('STRUCT1', 'mean'): data.iloc[:, 1],
    ('STRUCT2','max'): data.iloc[:, 2],

})
#table = df.to_html()

#print("UNIT = metres")
#print("method = mean,max")
df
```


Water depths may be negative for objects which have damage below the ground floor height, and the user is free to choose any water depth increments in the CSV file. The damage function CSV files can have any name the user would like to assign to them.
Multiple damage-functions can be described in one CSV file, by simply adding consecutive columns next to one another.

::: {.callout-tip}
You can also create damage functions with the [**HydroMT-FIAT  model builder**](https://deltares.github.io/hydromt_fiat/latest/#).
:::

::: {.callout-important}
 Water depth units (e.g. feet or meters) must be consistent with the units of the flood hazard map and the exposure data (ground elevation, ground floor height).
:::
